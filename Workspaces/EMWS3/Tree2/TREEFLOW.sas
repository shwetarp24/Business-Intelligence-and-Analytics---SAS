****************************************************************;
******             DECISION TREE SCORING CODE             ******;
****************************************************************;

******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
LENGTH F_TargetBuy  $   12; 
LENGTH I_TargetBuy  $   12; 
LENGTH _WARN_  $    4; 

******              LABELS FOR NEW VARIABLES              ******;
label _NODE_ = 'Node' ;
label _LEAF_ = 'Leaf' ;
label P_TargetBuy0 = 'Predicted: TargetBuy=0' ;
label P_TargetBuy1 = 'Predicted: TargetBuy=1' ;
label Q_TargetBuy0 = 'Unadjusted P: TargetBuy=0' ;
label Q_TargetBuy1 = 'Unadjusted P: TargetBuy=1' ;
label V_TargetBuy0 = 'Validated: TargetBuy=0' ;
label V_TargetBuy1 = 'Validated: TargetBuy=1' ;
label R_TargetBuy0 = 'Residual: TargetBuy=0' ;
label R_TargetBuy1 = 'Residual: TargetBuy=1' ;
label F_TargetBuy = 'From: TargetBuy' ;
label I_TargetBuy = 'Into: TargetBuy' ;
label U_TargetBuy = 'Unnormalized Into: TargetBuy' ;
label _WARN_ = 'Warnings' ;


******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12; 
_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
LENGTH _ARBFMT_1 $      1; DROP _ARBFMT_1; 
_ARBFMT_1 = ' '; /* Initialize to avoid warning. */


_ARBFMT_12 = PUT( TargetBuy , BEST12.);
 %DMNORMCP( _ARBFMT_12, F_TargetBuy );

******             ASSIGN OBSERVATION TO NODE             ******;
IF  NOT MISSING(DemAge ) AND 
  DemAge  <                 39.5 THEN DO;
  IF  NOT MISSING(DemAffl ) AND 
    DemAffl  <                  9.5 THEN DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('M' ) THEN DO;
      _NODE_  =                   15;
      _LEAF_  =                    2;
      P_TargetBuy0  =      0.6255707762557;
      P_TargetBuy1  =     0.37442922374429;
      Q_TargetBuy0  =      0.6255707762557;
      Q_TargetBuy1  =     0.37442922374429;
      V_TargetBuy0  =     0.65945945945945;
      V_TargetBuy1  =     0.34054054054054;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE IF _ARBFMT_1 IN ('F' ) THEN DO;
      IF  NOT MISSING(DemAffl ) AND 
        DemAffl  <                  6.5 THEN DO;
        _NODE_  =                   38;
        _LEAF_  =                    3;
        P_TargetBuy0  =     0.60115606936416;
        P_TargetBuy1  =     0.39884393063583;
        Q_TargetBuy0  =     0.60115606936416;
        Q_TargetBuy1  =     0.39884393063583;
        V_TargetBuy0  =     0.50273224043715;
        V_TargetBuy1  =     0.49726775956284;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   39;
        _LEAF_  =                    4;
        P_TargetBuy0  =     0.38622754491017;
        P_TargetBuy1  =     0.61377245508982;
        Q_TargetBuy0  =     0.38622754491017;
        Q_TargetBuy1  =     0.61377245508982;
        V_TargetBuy0  =     0.37978142076502;
        V_TargetBuy1  =     0.62021857923497;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      END;
    ELSE DO;
      _NODE_  =                   14;
      _LEAF_  =                    1;
      P_TargetBuy0  =     0.84931506849315;
      P_TargetBuy1  =     0.15068493150684;
      Q_TargetBuy0  =     0.84931506849315;
      Q_TargetBuy1  =     0.15068493150684;
      V_TargetBuy0  =                 0.85;
      V_TargetBuy1  =                 0.15;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  ELSE IF  NOT MISSING(DemAffl ) AND 
                    14.5 <= DemAffl  THEN DO;
    _NODE_  =                    7;
    _LEAF_  =                    8;
    P_TargetBuy0  =     0.04712041884816;
    P_TargetBuy1  =     0.95287958115183;
    Q_TargetBuy0  =     0.04712041884816;
    Q_TargetBuy1  =     0.95287958115183;
    V_TargetBuy0  =     0.06153846153846;
    V_TargetBuy1  =     0.93846153846153;
    I_TargetBuy  = '1' ;
    U_TargetBuy  =                    1;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   17;
      _LEAF_  =                    5;
      P_TargetBuy0  =     0.22271714922049;
      P_TargetBuy1  =     0.77728285077951;
      Q_TargetBuy0  =     0.22271714922049;
      Q_TargetBuy1  =     0.77728285077951;
      V_TargetBuy0  =      0.2043956043956;
      V_TargetBuy1  =     0.79560439560439;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
      _NODE_  =                   18;
      _LEAF_  =                    6;
      P_TargetBuy0  =      0.4388489208633;
      P_TargetBuy1  =     0.56115107913669;
      Q_TargetBuy0  =      0.4388489208633;
      Q_TargetBuy1  =     0.56115107913669;
      V_TargetBuy0  =                  0.5;
      V_TargetBuy1  =                  0.5;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE DO;
      _NODE_  =                   19;
      _LEAF_  =                    7;
      P_TargetBuy0  =     0.58730158730158;
      P_TargetBuy1  =     0.41269841269841;
      Q_TargetBuy0  =     0.58730158730158;
      Q_TargetBuy1  =     0.41269841269841;
      V_TargetBuy0  =     0.69354838709677;
      V_TargetBuy1  =     0.30645161290322;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  END;
ELSE IF  NOT MISSING(DemAge ) AND 
                  44.5 <= DemAge  THEN DO;
  IF  NOT MISSING(DemAffl ) AND 
                    10.5 <= DemAffl  AND
    DemAffl  <                 15.5 THEN DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      IF  NOT MISSING(DemAffl ) AND 
                        12.5 <= DemAffl  THEN DO;
        _NODE_  =                   56;
        _LEAF_  =                   29;
        P_TargetBuy0  =     0.55389221556886;
        P_TargetBuy1  =     0.44610778443113;
        Q_TargetBuy0  =     0.55389221556886;
        Q_TargetBuy1  =     0.44610778443113;
        V_TargetBuy0  =     0.48929663608562;
        V_TargetBuy1  =     0.51070336391437;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   55;
        _LEAF_  =                   28;
        P_TargetBuy0  =       0.690036900369;
        P_TargetBuy1  =     0.30996309963099;
        Q_TargetBuy0  =       0.690036900369;
        Q_TargetBuy1  =     0.30996309963099;
        V_TargetBuy0  =     0.69047619047619;
        V_TargetBuy1  =      0.3095238095238;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    ELSE DO;
      IF  NOT MISSING(DemAffl ) AND 
                        12.5 <= DemAffl  THEN DO;
        _NODE_  =                   58;
        _LEAF_  =                   31;
        P_TargetBuy0  =     0.79638009049773;
        P_TargetBuy1  =     0.20361990950226;
        Q_TargetBuy0  =     0.79638009049773;
        Q_TargetBuy1  =     0.20361990950226;
        V_TargetBuy0  =     0.80176211453744;
        V_TargetBuy1  =     0.19823788546255;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   57;
        _LEAF_  =                   30;
        P_TargetBuy0  =     0.89213483146067;
        P_TargetBuy1  =     0.10786516853932;
        Q_TargetBuy0  =     0.89213483146067;
        Q_TargetBuy1  =     0.10786516853932;
        V_TargetBuy0  =     0.88069414316702;
        V_TargetBuy1  =     0.11930585683297;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    END;
  ELSE IF  NOT MISSING(DemAffl ) AND 
                    15.5 <= DemAffl  THEN DO;
    IF  NOT MISSING(DemAffl ) AND 
                      18.5 <= DemAffl  THEN DO;
      _NODE_  =                   37;
      _LEAF_  =                   33;
      P_TargetBuy0  =     0.05263157894736;
      P_TargetBuy1  =     0.94736842105263;
      Q_TargetBuy0  =     0.05263157894736;
      Q_TargetBuy1  =     0.94736842105263;
      V_TargetBuy0  =     0.05714285714285;
      V_TargetBuy1  =     0.94285714285714;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE DO;
      _NODE_  =                   36;
      _LEAF_  =                   32;
      P_TargetBuy0  =             0.421875;
      P_TargetBuy1  =             0.578125;
      Q_TargetBuy0  =             0.421875;
      Q_TargetBuy1  =             0.578125;
      V_TargetBuy0  =     0.47747747747747;
      V_TargetBuy1  =     0.52252252252252;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      IF  NOT MISSING(DemAffl ) AND 
        DemAffl  <                  5.5 THEN DO;
        _NODE_  =                   47;
        _LEAF_  =                   20;
        P_TargetBuy0  =     0.94025157232704;
        P_TargetBuy1  =     0.05974842767295;
        Q_TargetBuy0  =     0.94025157232704;
        Q_TargetBuy1  =     0.05974842767295;
        V_TargetBuy0  =     0.91891891891891;
        V_TargetBuy1  =     0.08108108108108;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE IF  NOT MISSING(DemAffl ) AND 
                         5.5 <= DemAffl  AND
        DemAffl  <                  7.5 THEN DO;
        _NODE_  =                   48;
        _LEAF_  =                   21;
        P_TargetBuy0  =     0.86117381489842;
        P_TargetBuy1  =     0.13882618510158;
        Q_TargetBuy0  =     0.86117381489842;
        Q_TargetBuy1  =     0.13882618510158;
        V_TargetBuy0  =     0.89331770222743;
        V_TargetBuy1  =     0.10668229777256;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   49;
        _LEAF_  =                   22;
        P_TargetBuy0  =     0.80448065173116;
        P_TargetBuy1  =     0.19551934826883;
        Q_TargetBuy0  =     0.80448065173116;
        Q_TargetBuy1  =     0.19551934826883;
        V_TargetBuy0  =     0.79139504563233;
        V_TargetBuy1  =     0.20860495436766;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
      IF  NOT MISSING(DemAffl ) AND 
        DemAffl  <                  8.5 THEN DO;
        _NODE_  =                   50;
        _LEAF_  =                   23;
        P_TargetBuy0  =     0.95022222222222;
        P_TargetBuy1  =     0.04977777777777;
        Q_TargetBuy0  =     0.95022222222222;
        Q_TargetBuy1  =     0.04977777777777;
        V_TargetBuy0  =     0.94930875576036;
        V_TargetBuy1  =     0.05069124423963;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   51;
        _LEAF_  =                   24;
        P_TargetBuy0  =     0.88354898336414;
        P_TargetBuy1  =     0.11645101663585;
        Q_TargetBuy0  =     0.88354898336414;
        Q_TargetBuy1  =     0.11645101663585;
        V_TargetBuy0  =     0.90636042402826;
        V_TargetBuy1  =     0.09363957597173;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    ELSE DO;
      IF  NOT MISSING(DemAffl ) AND 
        DemAffl  <                  5.5 THEN DO;
        _NODE_  =                   52;
        _LEAF_  =                   25;
        P_TargetBuy0  =     0.99689440993788;
        P_TargetBuy1  =     0.00310559006211;
        Q_TargetBuy0  =     0.99689440993788;
        Q_TargetBuy1  =     0.00310559006211;
        V_TargetBuy0  =     0.99354838709677;
        V_TargetBuy1  =     0.00645161290322;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE IF  NOT MISSING(DemAffl ) AND 
                         9.5 <= DemAffl  THEN DO;
        _NODE_  =                   54;
        _LEAF_  =                   27;
        P_TargetBuy0  =     0.92028985507246;
        P_TargetBuy1  =     0.07971014492753;
        Q_TargetBuy0  =     0.92028985507246;
        Q_TargetBuy1  =     0.07971014492753;
        V_TargetBuy0  =     0.94578313253012;
        V_TargetBuy1  =     0.05421686746987;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   53;
        _LEAF_  =                   26;
        P_TargetBuy0  =     0.96786155747836;
        P_TargetBuy1  =     0.03213844252163;
        Q_TargetBuy0  =     0.96786155747836;
        Q_TargetBuy1  =     0.03213844252163;
        V_TargetBuy0  =     0.97796817625459;
        V_TargetBuy1  =     0.02203182374541;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    END;
  END;
ELSE DO;
  IF  NOT MISSING(DemAffl ) AND 
    DemAffl  <                  8.5 THEN DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   23;
      _LEAF_  =                    9;
      P_TargetBuy0  =     0.71714922048997;
      P_TargetBuy1  =     0.28285077951002;
      Q_TargetBuy0  =     0.71714922048997;
      Q_TargetBuy1  =     0.28285077951002;
      V_TargetBuy0  =     0.70319634703196;
      V_TargetBuy1  =     0.29680365296803;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
      _NODE_  =                   24;
      _LEAF_  =                   10;
      P_TargetBuy0  =     0.84753363228699;
      P_TargetBuy1  =       0.152466367713;
      Q_TargetBuy0  =     0.84753363228699;
      Q_TargetBuy1  =       0.152466367713;
      V_TargetBuy0  =     0.87203791469194;
      V_TargetBuy1  =     0.12796208530805;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE DO;
      _NODE_  =                   25;
      _LEAF_  =                   11;
      P_TargetBuy0  =     0.92957746478873;
      P_TargetBuy1  =     0.07042253521126;
      Q_TargetBuy0  =     0.92957746478873;
      Q_TargetBuy1  =     0.07042253521126;
      V_TargetBuy0  =     0.92682926829268;
      V_TargetBuy1  =     0.07317073170731;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  ELSE IF  NOT MISSING(DemAffl ) AND 
                     8.5 <= DemAffl  AND
    DemAffl  <                 11.5 THEN DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   26;
      _LEAF_  =                   12;
      P_TargetBuy0  =     0.53820598006644;
      P_TargetBuy1  =     0.46179401993355;
      Q_TargetBuy0  =     0.53820598006644;
      Q_TargetBuy1  =     0.46179401993355;
      V_TargetBuy0  =     0.49458483754512;
      V_TargetBuy1  =     0.50541516245487;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
      _NODE_  =                   27;
      _LEAF_  =                   13;
      P_TargetBuy0  =            0.7421875;
      P_TargetBuy1  =            0.2578125;
      Q_TargetBuy0  =            0.7421875;
      Q_TargetBuy1  =            0.2578125;
      V_TargetBuy0  =     0.81021897810219;
      V_TargetBuy1  =     0.18978102189781;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE DO;
      _NODE_  =                   28;
      _LEAF_  =                   14;
      P_TargetBuy0  =     0.88888888888888;
      P_TargetBuy1  =     0.11111111111111;
      Q_TargetBuy0  =     0.88888888888888;
      Q_TargetBuy1  =     0.11111111111111;
      V_TargetBuy0  =     0.83505154639175;
      V_TargetBuy1  =     0.16494845360824;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      IF  NOT MISSING(DemAge ) AND 
                        40.5 <= DemAge  THEN DO;
        _NODE_  =                   43;
        _LEAF_  =                   16;
        P_TargetBuy0  =      0.2027972027972;
        P_TargetBuy1  =     0.79720279720279;
        Q_TargetBuy0  =      0.2027972027972;
        Q_TargetBuy1  =     0.79720279720279;
        V_TargetBuy0  =     0.23308270676691;
        V_TargetBuy1  =     0.76691729323308;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      ELSE DO;
        _NODE_  =                   42;
        _LEAF_  =                   15;
        P_TargetBuy0  =     0.38888888888888;
        P_TargetBuy1  =     0.61111111111111;
        Q_TargetBuy0  =     0.38888888888888;
        Q_TargetBuy1  =     0.61111111111111;
        V_TargetBuy0  =     0.37762237762237;
        V_TargetBuy1  =     0.62237762237762;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      END;
    ELSE DO;
      IF  NOT MISSING(DemAffl ) AND 
                        12.5 <= DemAffl  AND
        DemAffl  <                 16.5 THEN DO;
        _NODE_  =                   45;
        _LEAF_  =                   18;
        P_TargetBuy0  =             0.453125;
        P_TargetBuy1  =             0.546875;
        Q_TargetBuy0  =             0.453125;
        Q_TargetBuy1  =             0.546875;
        V_TargetBuy0  =     0.53521126760563;
        V_TargetBuy1  =     0.46478873239436;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      ELSE IF  NOT MISSING(DemAffl ) AND 
                        16.5 <= DemAffl  THEN DO;
        _NODE_  =                   46;
        _LEAF_  =                   19;
        P_TargetBuy0  =                    0;
        P_TargetBuy1  =                    1;
        Q_TargetBuy0  =                    0;
        Q_TargetBuy1  =                    1;
        V_TargetBuy0  =     0.41666666666666;
        V_TargetBuy1  =     0.58333333333333;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      ELSE DO;
        _NODE_  =                   44;
        _LEAF_  =                   17;
        P_TargetBuy0  =     0.76470588235294;
        P_TargetBuy1  =     0.23529411764705;
        Q_TargetBuy0  =     0.76470588235294;
        Q_TargetBuy1  =     0.23529411764705;
        V_TargetBuy0  =                 0.75;
        V_TargetBuy1  =                 0.25;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    END;
  END;

*****  RESIDUALS R_ *************;
IF  F_TargetBuy  NE '0' 
AND F_TargetBuy  NE '1'  THEN DO; 
        R_TargetBuy0  = .;
        R_TargetBuy1  = .;
 END;
 ELSE DO;
       R_TargetBuy0  =  -P_TargetBuy0 ;
       R_TargetBuy1  =  -P_TargetBuy1 ;
       SELECT( F_TargetBuy  );
          WHEN( '0'  ) R_TargetBuy0  = R_TargetBuy0  +1;
          WHEN( '1'  ) R_TargetBuy1  = R_TargetBuy1  +1;
       END;
 END;

****************************************************************;
******          END OF DECISION TREE SCORING CODE         ******;
****************************************************************;

